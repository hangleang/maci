specVersion: 1.0.0
description: Subgraph Indexer for MACI contract
repository: https://github.com/hangleang/maci-subgraph
indexerHints:
  prune: auto
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum
    name: MACI
    network: { { network } }
    source:
      address: "{{ address }}"
      abi: MACI
      startBlock: { { startBlock } }
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - MACI
        - User
        - Account
        - StateLeaf
        - Poll
      abis:
        - name: MACI
          file: ./abis/MACI.json
      eventHandlers:
        - event: DeployPoll(uint256,(uint256,uint256),(address,address,address,address))
          handler: handleDeployPoll
        - event: OwnershipTransferred(indexed address,indexed address)
          handler: handleOwnershipTransferred
        - event: SignUp(uint256,(uint256,uint256),uint256,uint256)
          handler: handleSignUp
      file: ./src/maci.ts
templates:
  - kind: ethereum
    name: Poll
    network: { { network } }
    source:
      abi: Poll
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - MACI
        - StateLeaf
        - Poll
        - Vote
        - TopupCredit
      abis:
        - name: Poll
          file: ./abis/Poll.json
      eventHandlers:
        - event: MergeMaciStateAq(uint256,uint256)
          handler: handleMergeMaciStateAq
        - event: MergeMaciStateAqSubRoots(uint256)
          handler: handleMergeMaciStateAqSubRoots
        - event: MergeMessageAq(uint256)
          handler: handleMergeMessageAq
        - event: MergeMessageAqSubRoots(uint256)
          handler: handleMergeMessageAqSubRoots
        - event: OwnershipTransferred(indexed address,indexed address)
          handler: handleOwnershipTransferred
        - event: PublishMessage((uint256,uint256[10]),(uint256,uint256))
          handler: handlePublishMessage
        - event: TopupMessage((uint256,uint256[10]))
          handler: handleTopupMessage
      file: ./src/poll.ts
